---
// 1. Import the JSON
// Ensure this path is 100% correct relative to this component file.
// If your file is in "src/content/data/quotes.json", this path is correct.
import quotes from "../content/data/quotes.json";

// 2. Safety Check
const safeQuotes = quotes && quotes.length > 0 ? quotes : [
  { quote: "Data not found.", author: "System", role: "Error", id: 0 }
];
---

<div 
  id="random-quote-wrapper"
  data-quotes={JSON.stringify(safeQuotes)} 
  class="max-w-3xl mx-auto my-16 text-center px-6 min-h-[200px] flex flex-col justify-center opacity-0 translate-y-8"
>
  
  <div class="text-[#EA4726] opacity-20 text-6xl font-serif leading-none mb-4 select-none">
    &ldquo;
  </div>

  <blockquote 
    id="quote-text" 
    class="text-2xl md:text-4xl font-serif text-gray-800 italic leading-relaxed mb-6"
  >
    Loading...
  </blockquote>

  <div class="flex flex-col items-center">
    <div class="h-1 w-12 bg-[#EA4726] mb-4"></div> 
    
    <cite id="quote-author" class="not-italic text-lg font-bold text-gray-900 uppercase tracking-wide">
      </cite>
    
    <span id="quote-role" class="text-sm text-gray-500 font-medium mt-1">
      </span>
  </div>

</div>

<script>
  // Standard Script: Imports work perfectly here
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // 1. Get Elements
  const container = document.getElementById('random-quote-wrapper');
  const textEl = document.getElementById('quote-text');
  const authorEl = document.getElementById('quote-author');
  const roleEl = document.getElementById('quote-role');

  if (container) {
    try {
      // 2. Retrieve and Parse Data from the Attribute
      const rawData = container.dataset.quotes;
      const quotes = JSON.parse(rawData);

      // 3. Pick Random Quote
      if (quotes && quotes.length > 0) {
        const randomIdx = Math.floor(Math.random() * quotes.length);
        const quote = quotes[randomIdx];

        // 4. Update DOM
        if (textEl) textEl.innerText = quote.quote;
        if (authorEl) authorEl.innerText = quote.author;
        if (roleEl) roleEl.innerText = quote.role || "";
      }

      // 5. Run Animation
      // We use 'to' because we set the initial state (opacity-0) in CSS classes above
      gsap.to(container, {
        scrollTrigger: {
          trigger: container,
          start: 'top 85%',
          toggleActions: 'play none none reverse'
        },
        opacity: 1,
        y: 0,
        duration: 1,
        ease: 'power3.out'
      });

    } catch (e) {
      console.error("Quote Logic Failed:", e);
      // Fallback: Make it visible if something broke
      gsap.set(container, { opacity: 1, y: 0 });
    }
  }
</script>